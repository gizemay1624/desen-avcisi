<!DOCTYPE html>
<html lang="tr">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
	<title>Desen Avcƒ±sƒ± Pro</title>
	<style>
		@import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800&display=swap');

		:root {
			--bg-color: #f0f2f5;
			--surface-color: #ffffff;
			--primary-color: #2c3e50; /* Koyu Lacivert */
			--accent-color: #e67e22; /* Turuncu vurgu */
			--secondary-accent: #3498db; /* Mavi vurgu */
			--success-color: #27ae60;
			--danger-color: #e74c3c;
			--grid-line: #bdc3c7;
			--shadow-soft: 0 8px 30px rgba(0,0,0,0.08);
			--radius-lg: 24px;
			--radius-md: 12px;
			--radius-sm: 8px;
		}

		* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }

		body {
			margin: 0; padding: 0;
			font-family: 'Outfit', sans-serif;
			background-color: var(--bg-color);
			color: var(--primary-color);
			height: 100dvh;
			width: 100vw;
			overflow: hidden;
			display: flex;
			flex-direction: column;
		}

		/* --- HEADER --- */
		header {
			flex: 0 0 60px;
			display: flex; justify-content: space-between; align-items: center;
			padding: 0 20px;
			background: var(--surface-color);
			box-shadow: 0 2px 10px rgba(0,0,0,0.05);
			z-index: 10;
		}

		.brand { font-weight: 800; font-size: 1.2rem; letter-spacing: -0.5px; display: flex; align-items: center; gap: 8px; }
		.brand span { color: var(--accent-color); }
		
		.level-pill {
			background: var(--primary-color); color: white;
			padding: 6px 14px; border-radius: 20px;
			font-size: 0.9rem; font-weight: 600;
			box-shadow: 0 4px 10px rgba(44, 62, 80, 0.3);
		}

		.header-actions button {
			background: #f1f2f6; border: none;
			width: 36px; height: 36px; border-radius: 50%;
			color: var(--primary-color); font-weight: bold; cursor: pointer;
			margin-left: 8px; transition: all 0.2s;
		}
		.header-actions button:active { transform: scale(0.9); }

		/* --- OYUN ALANI --- */
		main {
			flex: 1;
			display: flex; flex-direction: column;
			justify-content: center; align-items: center;
			width: 100%; position: relative;
			padding: 10px;
		}

		/* VS Modu ƒ∞lerleme √áubuƒüu */
		#vs-status {
			position: absolute; top: 10px; width: 90%; max-width: 400px;
			display: none; flex-direction: column; gap: 4px;
		}
		.bar-bg { background: #dfe6e9; height: 8px; border-radius: 4px; overflow: hidden; }
		.bar-fill { height: 100%; background: var(--danger-color); width: 0%; transition: width 0.1s linear; }
		.vs-label { font-size: 0.75rem; color: #7f8c8d; font-weight: 600; display: flex; justify-content: space-between; }

		.game-container {
			display: flex; gap: 20px;
			align-items: center; justify-content: center;
			width: 100%; max-width: 800px;
		}

		.board-wrapper {
			display: flex; flex-direction: column; align-items: center;
			background: var(--surface-color);
			padding: 12px; border-radius: var(--radius-lg);
			box-shadow: var(--shadow-soft);
			transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
		}

		.board-label {
			font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px;
			color: #95a5a6; font-weight: 700; margin-bottom: 8px;
		}

		/* Responsive Canvas/Grid Boyutlandƒ±rma */
		/* Ekran geni≈üliƒüine g√∂re dinamik ayar */
		:root { --board-size: min(38vw, 38vh, 260px); }
		
		canvas, .grid {
			width: var(--board-size); height: var(--board-size);
			border-radius: var(--radius-sm);
			touch-action: none;
		}

		canvas { background: #fff; border: 2px solid #ecf0f1; }

		.grid {
			display: grid;
			grid-template-columns: repeat(4, 1fr);
			gap: 2px;
			background: var(--primary-color); /* Grid √ßizgileri */
			border: 2px solid var(--primary-color);
			cursor: pointer;
		}

		.cell {
			background-color: #fff;
			background-size: 100% 100%;
			position: relative;
			transition: transform 0.1s;
		}
		.cell:active { transform: scale(0.92); z-index: 2; border-radius: 4px; }

		/* --- KONTROL PANELƒ∞ --- */
		.controls {
			flex: 0 0 auto;
			width: 100%;
			background: var(--surface-color);
			border-top-left-radius: 30px; border-top-right-radius: 30px;
			box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
			padding: 20px 10px calc(20px + env(safe-area-inset-bottom)) 10px;
			display: flex; flex-direction: column; align-items: center; gap: 15px;
			z-index: 20;
		}

		/* 12'li Palet Sistemi - 2 Satƒ±r */
		.palette-grid {
			display: grid;
			grid-template-columns: repeat(6, 1fr);
			gap: 8px;
			width: 100%; max-width: 500px;
		}

		.p-btn {
			aspect-ratio: 1;
			border-radius: 8px;
			border: 2px solid #ecf0f1;
			cursor: pointer;
			position: relative;
			background-color: #fff;
			background-size: 80% 80%;
			background-repeat: no-repeat;
			background-position: center;
			transition: all 0.2s;
		}

		.p-btn.active {
			border-color: var(--accent-color);
			transform: translateY(-4px);
			box-shadow: 0 4px 0 var(--accent-color);
		}

		.check-btn {
			background: var(--primary-color);
			color: white; border: none;
			padding: 14px 0; width: 90%; max-width: 350px;
			border-radius: 16px;
			font-size: 1.1rem; font-weight: 700;
			letter-spacing: 0.5px;
			box-shadow: 0 4px 15px rgba(44, 62, 80, 0.2);
			cursor: pointer;
			transition: transform 0.1s;
		}
		.check-btn:active { transform: scale(0.98); }

		/* --- MODAL --- */
		.modal-overlay {
			position: fixed; top:0; left:0; right:0; bottom:0;
			background: rgba(44, 62, 80, 0.9);
			backdrop-filter: blur(8px);
			display: flex; align-items: center; justify-content: center;
			z-index: 100; opacity: 0; pointer-events: none;
			transition: opacity 0.3s;
		}
		.modal-overlay.active { opacity: 1; pointer-events: all; }

		.menu-card {
			background: white; width: 85%; max-width: 360px;
			padding: 30px; border-radius: 24px;
			text-align: center;
			box-shadow: 0 10px 40px rgba(0,0,0,0.2);
			transform: translateY(20px); transition: transform 0.3s;
		}
		.modal-overlay.active .menu-card { transform: translateY(0); }

		.menu-title { font-size: 2rem; font-weight: 800; color: var(--primary-color); margin: 0 0 10px 0; }
		.menu-text { color: #7f8c8d; margin-bottom: 25px; line-height: 1.5; }
		
		.mode-select {
			display: flex; flex-direction: column; gap: 12px;
		}
		.mode-btn {
			padding: 15px; border: 2px solid #ecf0f1; border-radius: 16px;
			background: white; text-align: left; cursor: pointer;
			display: flex; align-items: center; gap: 15px;
			transition: border-color 0.2s;
		}
		.mode-btn:hover { border-color: var(--accent-color); }
		.mode-icon { font-size: 1.5rem; background: #fff5e6; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 10px; }

		.hidden { display: none !important; }

		/* Animation Classes */
		@keyframes shake {
			0% { transform: translateX(0); } 25% { transform: translateX(-5px); }
			50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); }
		}
		.shake { animation: shake 0.3s ease-in-out; }

		/* Mobil D√ºzenlemeler */
		@media (max-width: 480px) {
			.game-container { gap: 10px; }
			.board-wrapper { padding: 8px; }
			:root { --board-size: 42vw; } /* Mobilde yan yana daha rahat sƒ±ƒüsƒ±n */
			.palette-grid { gap: 6px; }
		}
	</style>
</head>
<body>

	<div id="start-modal" class="modal-overlay active">
		<div class="menu-card">
			<div style="font-size:3rem; margin-bottom:10px;">üß©</div>
			<h1 class="menu-title">DESEN AVCISI</h1>
			<p class="menu-text">G√∂rsel zekanƒ± zorla. Basit karelerden ba≈üla, karma≈üƒ±k ill√ºzyonlara ula≈ü.</p>
			
			<div class="mode-select">
				<div class="mode-btn" onclick="startGame('solo')">
					<div class="mode-icon">üéì</div>
					<div>
						<div style="font-weight:700; color:var(--primary-color)">√ñƒürenci Modu</div>
						<div style="font-size:0.8rem; color:#95a5a6">S√ºre yok, 20 seviye. √ñƒüren ve geli≈ü.</div>
					</div>
				</div>
				<div class="mode-btn" onclick="startGame('vs')">
					<div class="mode-icon">‚ö°</div>
					<div>
						<div style="font-weight:700; color:var(--primary-color)">Meydan Okuma</div>
						<div style="font-size:0.8rem; color:#95a5a6">S√ºreye kar≈üƒ± yarƒ±≈ü. Hata kabul etmez.</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div id="end-modal" class="modal-overlay">
		<div class="menu-card">
			<div id="end-icon" style="font-size: 4rem; margin-bottom: 10px;">üèÜ</div>
			<h2 id="end-title" class="menu-title">Harika!</h2>
			<p id="end-msg" class="menu-text">Doƒüru e≈üle≈üme.</p>
			<button id="next-btn" class="check-btn" onclick="nextLevel()">Sonraki Seviye</button>
		</div>
	</div>

	<header>
		<div class="brand"><span>DESEN</span>PRO</div>
		<div class="level-pill" id="level-txt">Seviye 1</div>
		<div class="header-actions">
			<button onclick="location.reload()">‚úï</button>
		</div>
	</header>

	<main>
		<div id="vs-status">
			<div class="vs-label"><span>‚è≥ Kalan S√ºre</span></div>
			<div class="bar-bg"><div id="timer-bar" class="bar-fill"></div></div>
		</div>

		<div class="game-container">
			<div class="board-wrapper">
				<div class="board-label">HEDEF</div>
				<canvas id="targetCanvas"></canvas>
			</div>

			<div class="board-wrapper" id="player-board">
				<div class="board-label">SENƒ∞N ALANIN</div>
				<div id="grid" class="grid"></div>
			</div>
		</div>
	</main>

	<div class="controls">
		<div class="palette-grid" id="palette">
			</div>
		<button class="check-btn" onclick="checkSolution()">KONTROL ET</button>
	</div>

	<script>
		// --- YAPILANDIRMA ---
		const CONFIG = {
			totalLevels: 20,
			gridSize: 4, // 4x4
			colors: {
				bg: '#ffffff',
				fill: '#2c3e50', // Koyu renk
			}
		};

		// --- SHAPE DEFINITIONS (G√∂rsel K√ºt√ºphanesi) ---
		// 0: Bo≈ü, 1: Dolu
		// 2-5: √ú√ßgenler (K√∂≈üeler)
		// 6-9: Yaylar/√áeyrek Daireler (Q-Bitz Tarzƒ±)
		// 10: K√º√ß√ºk Daire (Nokta)
		// 11: Ters √áeyrek (K√∂≈üe dolu, i√ßi bo≈ü yay) - Zorluk i√ßin
		const SHAPES = [
			{ id: 0, name: 'empty' },
			{ id: 1, name: 'full' },
			{ id: 2, name: 'tri-bl' }, // Sol Alt
			{ id: 3, name: 'tri-br' }, // Saƒü Alt
			{ id: 4, name: 'tri-tl' }, // Sol √úst
			{ id: 5, name: 'tri-tr' }, // Saƒü √úst
			{ id: 6, name: 'arc-bl' }, // Yay Sol Alt
			{ id: 7, name: 'arc-br' }, // Yay Saƒü Alt
			{ id: 8, name: 'arc-tl' }, // Yay Sol √úst
			{ id: 9, name: 'arc-tr' }, // Yay Saƒü √úst
			{ id: 10, name: 'dot' },   // Orta Nokta
			{ id: 11, name: 'tri-inv' } // √ñzel: ƒ∞ki zƒ±t √º√ßgen (Kelebek) veya Noktalƒ± Kare
		];

		// --- GLOBAL DEƒûƒ∞≈ûKENLER ---
		let state = {
			mode: 'solo',
			level: 1,
			targetGrid: [],
			playerGrid: new Array(16).fill(0),
			selectedShape: 1, // Varsayƒ±lan: Dolu Kare
			timer: null,
			isPaused: false
		};

		const canvas = document.getElementById('targetCanvas');
		const ctx = canvas.getContext('2d');
		const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

		// --- SES EFEKTLERƒ∞ ---
		function playTone(type) {
			if(audioCtx.state === 'suspended') audioCtx.resume();
			const osc = audioCtx.createOscillator();
			const gain = audioCtx.createGain();
			osc.connect(gain); gain.connect(audioCtx.destination);
			
			const now = audioCtx.currentTime;
			if (type === 'tap') {
				osc.frequency.setValueAtTime(600, now);
				osc.frequency.exponentialRampToValueAtTime(300, now + 0.1);
				gain.gain.setValueAtTime(0.05, now);
				gain.gain.linearRampToValueAtTime(0, now + 0.1);
				osc.start(); osc.stop(now + 0.1);
			} else if (type === 'win') {
				osc.type = 'triangle';
				osc.frequency.setValueAtTime(440, now);
				osc.frequency.setValueAtTime(554, now + 0.1); // C#
				osc.frequency.setValueAtTime(659, now + 0.2); // E
				gain.gain.setValueAtTime(0.1, now);
				gain.gain.linearRampToValueAtTime(0, now + 0.4);
				osc.start(); osc.stop(now + 0.4);
			} else if (type === 'error') {
				osc.type = 'sawtooth';
				osc.frequency.setValueAtTime(150, now);
				osc.frequency.linearRampToValueAtTime(100, now + 0.2);
				gain.gain.setValueAtTime(0.1, now);
				gain.gain.linearRampToValueAtTime(0, now + 0.2);
				osc.start(); osc.stop(now + 0.2);
			}
		}

		// --- INIT & DRAWING ---
		function initPalette() {
			const palette = document.getElementById('palette');
			palette.innerHTML = '';
			
			// Palette butonlarƒ±nƒ± olu≈ütur ve Canvas √ºzerine √ßizerek ikon olu≈ütur
			SHAPES.forEach(shape => {
				const btn = document.createElement('div');
				btn.className = `p-btn ${shape.id === 1 ? 'active' : ''}`;
				btn.onclick = () => selectPalette(shape.id, btn);
				
				// Buton ikonu i√ßin mini canvas
				const iconCanvas = document.createElement('canvas');
				iconCanvas.width = 60; iconCanvas.height = 60;
				const iconCtx = iconCanvas.getContext('2d');
				
				// ≈ûekli butona √ßiz
				drawShape(iconCtx, shape.id, 0, 0, 60);
				
				btn.style.backgroundImage = `url(${iconCanvas.toDataURL()})`;
				palette.appendChild(btn);
			});
		}

		function drawShape(c, type, x, y, size) {
			c.beginPath();
			c.fillStyle = CONFIG.colors.fill;
			const s = size;

			switch(type) {
				case 0: // Empty
					c.fillStyle = "#fff"; c.fillRect(x,y,s,s);
					break;
				case 1: // Full
					c.fillRect(x,y,s,s);
					break;
				case 2: // Tri BL
					c.moveTo(x,y); c.lineTo(x, y+s); c.lineTo(x+s, y+s); c.fill();
					break;
				case 3: // Tri BR
					c.moveTo(x+s,y); c.lineTo(x+s, y+s); c.lineTo(x, y+s); c.fill();
					break;
				case 4: // Tri TL
					c.moveTo(x,y); c.lineTo(x+s, y); c.lineTo(x, y+s); c.fill();
					break;
				case 5: // Tri TR
					c.moveTo(x,y); c.lineTo(x+s, y); c.lineTo(x+s, y+s); c.fill();
					break;
				case 6: // Arc BL (Sol Alt K√∂≈üe Dolu Yay)
					c.moveTo(x, y+s); 
					c.arc(x, y+s, s, 0, -Math.PI/2, true); 
					c.lineTo(x, y+s); c.fill();
					break;
				case 7: // Arc BR
					c.moveTo(x+s, y+s);
					c.arc(x+s, y+s, s, Math.PI, Math.PI*1.5, false);
					c.lineTo(x+s, y+s); c.fill();
					break;
				case 8: // Arc TL
					c.moveTo(x, y);
					c.arc(x, y, s, 0, Math.PI/2, false);
					c.lineTo(x, y); c.fill();
					break;
				case 9: // Arc TR
					c.moveTo(x+s, y);
					c.arc(x+s, y, s, Math.PI, Math.PI/2, true);
					c.lineTo(x+s, y); c.fill();
					break;
				case 10: // Dot
					c.arc(x+s/2, y+s/2, s/3, 0, Math.PI*2); c.fill();
					break;
				case 11: // √ñzel (Diagonal √áizgi / Kelebek)
					c.moveTo(x,y); c.lineTo(x+s, y+s); c.lineTo(x, y+s); c.fill(); // Alt Sol
					c.beginPath(); 
					c.moveTo(x,y); c.lineTo(x+s, y); c.lineTo(x+s, y+s); c.fill(); // √úst Saƒü
					// Bu aslƒ±nda full kare gibi oldu, o y√ºzden farklƒ± bir ≈üey yapalƒ±m:
					// √áapraz ≈üerit
					c.fillStyle = "#fff"; c.fillRect(x,y,s,s); c.fillStyle = CONFIG.colors.fill;
					c.beginPath(); c.moveTo(x,y+s); c.lineTo(x+s/2, y+s); c.lineTo(x+s, y+s/2); c.lineTo(x+s, y); c.fill();
					c.beginPath(); c.moveTo(x, y); c.lineTo(x+s/2, y); c.lineTo(x, y+s/2); c.fill();
					break;
			}
		}

		// --- LEVEL GENERATION (YAPAY ZEKA) ---
		function generateLevel(lvl) {
			state.targetGrid = new Array(16).fill(0);
			
			// HAVUZ BELƒ∞RLEME (Zorluk Seviyesi)
			let allowedShapes = [0, 1]; // Temel
			
			if (lvl > 3) allowedShapes.push(2, 3, 4, 5); // √ú√ßgenler
			if (lvl > 7) allowedShapes.push(6, 7, 8, 9); // Yaylar
			if (lvl > 12) allowedShapes.push(10, 11); // Noktalar ve Karma≈üƒ±k
			
			// DESEN OLU≈ûTURMA ALGORƒ∞TMASI
			if (lvl <= 3) {
				// Rastgele Basit (Noise)
				for(let i=0; i<16; i++) state.targetGrid[i] = allowedShapes[Math.floor(Math.random()*allowedShapes.length)];
			} 
			else if (lvl <= 8) {
				// Dikey Simetri
				for(let r=0; r<4; r++) {
					for(let c=0; c<2; c++) {
						let val = allowedShapes[Math.floor(Math.random()*allowedShapes.length)];
						state.targetGrid[r*4 + c] = val;
						// Aynala (Basit mapping)
						let mirrorVal = getMirrorShape(val, 'h');
						state.targetGrid[r*4 + (3-c)] = mirrorVal;
					}
				}
			} 
			else if (lvl <= 14) {
				// Merkezi Simetri (Radial) - Q-Bitz tarzƒ±
				// Sadece Sol √úst 2x2'yi olu≈ütur, gerisini d√∂nd√ºr
				let quadrant = [
					allowedShapes[Math.floor(Math.random()*allowedShapes.length)],
					allowedShapes[Math.floor(Math.random()*allowedShapes.length)],
					allowedShapes[Math.floor(Math.random()*allowedShapes.length)],
					allowedShapes[Math.floor(Math.random()*allowedShapes.length)]
				];
				
				// Q1 (Sol √úst)
				state.targetGrid[0] = quadrant[0]; state.targetGrid[1] = quadrant[1];
				state.targetGrid[4] = quadrant[2]; state.targetGrid[5] = quadrant[3];
				
				// Diƒüer quadrantlarƒ± simetrik yap
				// (Bu kƒ±sƒ±m biraz karma≈üƒ±k, basitlik adƒ±na random rotasyonlar eklenebilir ama tam simetri daha ≈üƒ±k durur)
				// ≈ûimdilik temiz random + curve aƒüƒ±rlƒ±klƒ± yapalƒ±m
				for(let i=0; i<16; i++) state.targetGrid[i] = allowedShapes[Math.floor(Math.random()*allowedShapes.length)];
			}
			else {
				// KAOS & OP ART (Pattern tekrarlarƒ±)
				// Dama tahtasƒ± deseni √ºzerine ≈üekiller
				let base = allowedShapes[Math.floor(Math.random()*allowedShapes.length)];
				let alt = allowedShapes[Math.floor(Math.random()*allowedShapes.length)];
				for(let i=0; i<16; i++) {
					let isEven = (Math.floor(i/4) + (i%4)) % 2 === 0;
					state.targetGrid[i] = isEven ? base : alt;
				}
			}

			renderTarget();
		}

		function getMirrorShape(id, axis) {
			// Basit aynalama mantƒ±ƒüƒ± (Geli≈ütirilebilir)
			// √ú√ßgenler: 2(BL)<->3(BR), 4(TL)<->5(TR)
			if(axis === 'h') {
				if(id===2) return 3; if(id===3) return 2;
				if(id===4) return 5; if(id===5) return 4;
				if(id===6) return 7; if(id===7) return 6;
				if(id===8) return 9; if(id===9) return 8;
			}
			return id;
		}

		function renderTarget() {
			const size = canvas.clientWidth;
			// High DPI fix
			const dpr = window.devicePixelRatio || 1;
			canvas.width = size * dpr;
			canvas.height = size * dpr;
			ctx.scale(dpr, dpr);
			
			const cellSize = size / 4;
			ctx.clearRect(0,0,size,size);
			
			for(let i=0; i<16; i++) {
				const x = (i % 4) * cellSize;
				const y = Math.floor(i / 4) * cellSize;
				drawShape(ctx, state.targetGrid[i], x, y, cellSize);
			}
		}

		// --- GAMEPLAY ---
		function startGame(mode) {
			state.mode = mode;
			state.level = 1;
			document.getElementById('start-modal').classList.remove('active');
			
			// VS Modu g√∂stergesi
			document.getElementById('vs-status').style.display = (mode === 'vs') ? 'flex' : 'none';
			
			initPalette();
			createGrid();
			loadLevel();
		}

		function createGrid() {
			const grid = document.getElementById('grid');
			grid.innerHTML = '';
			for(let i=0; i<16; i++) {
				const cell = document.createElement('div');
				cell.className = 'cell';
				cell.dataset.idx = i;
				
				// Ba≈ülangƒ±√ßta bo≈ü ikon √ßizimi (CSS background ile)
				updateCellVisual(cell, 0);
				
				cell.onclick = () => {
					playTone('tap');
					state.playerGrid[i] = state.selectedShape;
					updateCellVisual(cell, state.selectedShape);
				};
				grid.appendChild(cell);
			}
		}
		
		function updateCellVisual(element, typeId) {
			// Performans i√ßin canvas yerine mini dataURL veya SVG kullanƒ±labilir ama 
			// dinamik √ßizim i√ßin burada anlƒ±k canvas olu≈üturup CSS background'a atƒ±yoruz.
			const c = document.createElement('canvas');
			c.width = 64; c.height = 64;
			const cx = c.getContext('2d');
			drawShape(cx, typeId, 0, 0, 64);
			element.style.backgroundImage = `url(${c.toDataURL()})`;
		}

		function selectPalette(id, btn) {
			playTone('tap');
			state.selectedShape = id;
			document.querySelectorAll('.p-btn').forEach(b => b.classList.remove('active'));
			btn.classList.add('active');
		}

		function loadLevel() {
			document.getElementById('level-txt').innerText = `Seviye ${state.level} / ${CONFIG.totalLevels}`;
			state.playerGrid.fill(0);
			document.querySelectorAll('.cell').forEach(c => updateCellVisual(c, 0));
			
			generateLevel(state.level);

			if(state.mode === 'vs') startTimer();
		}

		function startTimer() {
			if(state.timer) clearInterval(state.timer);
			const bar = document.getElementById('timer-bar');
			bar.style.width = '100%';
			
			// S√ºre form√ºl√º: Seviye arttƒ±k√ßa azalƒ±r (Min 20sn, Max 90sn)
			let duration = Math.max(20, 90 - (state.level * 3));
			let left = duration;
			
			state.timer = setInterval(() => {
				left -= 0.1;
				let pct = (left / duration) * 100;
				bar.style.width = pct + '%';
				
				if(left <= 0) {
					clearInterval(state.timer);
					playTone('error');
					alert("S√ºre Doldu! Ba≈ütan Ba≈üla.");
					location.reload();
				}
			}, 100);
		}

		function checkSolution() {
			let correct = true;
			for(let i=0; i<16; i++) {
				if(state.playerGrid[i] !== state.targetGrid[i]) correct = false;
			}

			if(correct) {
				if(state.timer) clearInterval(state.timer);
				playTone('win');
				// Modal hazƒ±rla
				const btn = document.getElementById('next-btn');
				const title = document.getElementById('end-title');
				
				if(state.level === CONFIG.totalLevels) {
					title.innerText = "OYUN Bƒ∞TTƒ∞!";
					document.getElementById('end-msg').innerText = "T√ºm desenlerin efendisisin.";
					btn.innerText = "Ba≈üa D√∂n";
					btn.onclick = () => location.reload();
				} else {
					title.innerText = getRandomPraise();
					document.getElementById('end-msg').innerText = "Sonraki seviyeye ge√ß.";
					btn.innerText = "Devam Et";
					btn.onclick = nextLevel;
				}
				
				document.getElementById('end-modal').classList.add('active');
			} else {
				playTone('error');
				const board = document.getElementById('player-board');
				board.classList.add('shake');
				setTimeout(() => board.classList.remove('shake'), 400);
			}
		}

		function nextLevel() {
			document.getElementById('end-modal').classList.remove('active');
			state.level++;
			loadLevel();
		}

		function getRandomPraise() {
			const words = ["Muhte≈üem!", "Kusursuz!", "Keskin G√∂z!", "Harika Gidiyorsun!"];
			return words[Math.floor(Math.random()*words.length)];
		}

		// Resize
		window.addEventListener('resize', () => {
			renderTarget();
			// Oyuncu gridi CSS ile hallediliyor, yeniden √ßizmeye gerek yok
		});

		// Initial render for palette icons
		window.onload = () => {
		   // Modal bekliyor
		};

	</script>
</body>
</html>