<!DOCTYPE html>
<html lang="tr">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
	<title>Desen Avcƒ±sƒ±</title>
	<style>
		@import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800&display=swap');

		:root {
			--bg-color: #f0f2f5;
			--surface-color: #ffffff;
			--primary-color: #2c3e50; /* Koyu Lacivert */
			--accent-color: #e67e22; /* Turuncu vurgu */
			--secondary-accent: #3498db; /* Mavi vurgu */
			--success-color: #27ae60;
			--danger-color: #e74c3c;
			--grid-line: #bdc3c7;
			--shadow-soft: 0 8px 30px rgba(0,0,0,0.08);
			--radius-lg: 24px;
			--radius-md: 12px;
			--radius-sm: 8px;
		}

		* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }

		body {
			margin: 0; padding: 0;
			font-family: 'Outfit', sans-serif;
			background-color: var(--bg-color);
			color: var(--primary-color);
			height: 100dvh;
			width: 100vw;
			overflow: hidden;
			display: flex;
			flex-direction: column;
		}

		/* --- HEADER --- */
		header {
			flex: 0 0 60px;
			display: flex; justify-content: space-between; align-items: center;
			padding: 0 20px;
			background: var(--surface-color);
			box-shadow: 0 2px 10px rgba(0,0,0,0.05);
			z-index: 10;
		}

		.brand { font-weight: 800; font-size: 1.2rem; letter-spacing: -0.5px; display: flex; align-items: center; gap: 8px; }
		.brand span { color: var(--accent-color); }
		
		.level-pill {
			background: var(--primary-color); color: white;
			padding: 6px 14px; border-radius: 20px;
			font-size: 0.9rem; font-weight: 600;
			box-shadow: 0 4px 10px rgba(44, 62, 80, 0.3);
		}

		.header-actions { display: flex; align-items: center; }
		.header-actions button {
			background: #f1f2f6; border: none;
			width: 36px; height: 36px; border-radius: 50%;
			color: var(--primary-color); font-weight: bold; cursor: pointer;
			margin-left: 8px; transition: all 0.2s;
			font-family: inherit; font-size: 1rem;
			display: flex; align-items: center; justify-content: center;
		}
		.header-actions button:active { transform: scale(0.9); }
		.exit-btn { color: var(--danger-color) !important; background: #ffeaea !important; }

		/* --- OYUN ALANI --- */
		main {
			flex: 1;
			display: flex; flex-direction: column;
			justify-content: center; align-items: center;
			width: 100%; position: relative;
			padding: 10px;
		}

		/* VS Modu ƒ∞lerleme √áubuƒüu */
		#vs-status {
			position: absolute; top: 10px; width: 90%; max-width: 400px;
			display: none; flex-direction: column; gap: 4px;
		}
		.bar-bg { background: #dfe6e9; height: 8px; border-radius: 4px; overflow: hidden; }
		.bar-fill { height: 100%; background: var(--danger-color); width: 0%; transition: width 0.1s linear; }
		.vs-label { font-size: 0.75rem; color: #7f8c8d; font-weight: 600; display: flex; justify-content: space-between; }

		.game-container {
			display: flex; gap: 20px;
			align-items: center; justify-content: center;
			width: 100%; max-width: 800px;
		}

		.board-wrapper {
			display: flex; flex-direction: column; align-items: center;
			background: var(--surface-color);
			padding: 12px; border-radius: var(--radius-lg);
			box-shadow: var(--shadow-soft);
			transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
		}

		.board-label {
			font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px;
			color: #95a5a6; font-weight: 700; margin-bottom: 8px;
		}

		/* Responsive Canvas/Grid Boyutlandƒ±rma */
		:root { --board-size: min(38vw, 38vh, 260px); }
		
		canvas, .grid {
			width: var(--board-size); height: var(--board-size);
			border-radius: var(--radius-sm);
			touch-action: none;
		}

		canvas { background: #fff; border: 2px solid #ecf0f1; }

		.grid {
			display: grid;
			grid-template-columns: repeat(4, 1fr);
			gap: 2px;
			background: var(--primary-color);
			border: 2px solid var(--primary-color);
			cursor: pointer;
		}

		.cell {
			background-color: #fff;
			background-size: 100% 100%;
			position: relative;
			transition: transform 0.1s;
		}
		.cell:active { transform: scale(0.92); z-index: 2; border-radius: 4px; }

		/* --- KONTROL PANELƒ∞ --- */
		.controls {
			flex: 0 0 auto;
			width: 100%;
			background: var(--surface-color);
			border-top-left-radius: 30px; border-top-right-radius: 30px;
			box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
			padding: 20px 10px calc(20px + env(safe-area-inset-bottom)) 10px;
			display: flex; flex-direction: column; align-items: center; gap: 15px;
			z-index: 20;
		}

		.palette-grid {
			display: grid;
			grid-template-columns: repeat(6, 1fr);
			gap: 8px;
			width: 100%; max-width: 500px;
		}

		.p-btn {
			aspect-ratio: 1;
			border-radius: 8px;
			border: 2px solid #ecf0f1;
			cursor: pointer;
			position: relative;
			background-color: #fff;
			background-size: 80% 80%;
			background-repeat: no-repeat;
			background-position: center;
			transition: all 0.2s;
		}

		.p-btn.active {
			border-color: var(--accent-color);
			transform: translateY(-4px);
			box-shadow: 0 4px 0 var(--accent-color);
		}

		.check-btn {
			background: var(--primary-color);
			color: white; border: none;
			padding: 14px 0; width: 90%; max-width: 350px;
			border-radius: 16px;
			font-size: 1.1rem; font-weight: 700;
			letter-spacing: 0.5px;
			box-shadow: 0 4px 15px rgba(44, 62, 80, 0.2);
			cursor: pointer;
			transition: transform 0.1s;
		}
		.check-btn:active { transform: scale(0.98); }

		/* --- MODAL --- */
		.modal-overlay {
			position: fixed; top:0; left:0; right:0; bottom:0;
			background: rgba(44, 62, 80, 0.9);
			backdrop-filter: blur(8px);
			display: flex; align-items: center; justify-content: center;
			z-index: 100; opacity: 0; pointer-events: none;
			transition: opacity 0.3s;
		}
		.modal-overlay.active { opacity: 1; pointer-events: all; }

		.menu-card {
			background: white; width: 85%; max-width: 360px;
			padding: 30px; border-radius: 24px;
			text-align: center;
			box-shadow: 0 10px 40px rgba(0,0,0,0.2);
			transform: translateY(20px); transition: transform 0.3s;
			max-height: 90vh; overflow-y: auto;
		}
		.modal-overlay.active .menu-card { transform: translateY(0); }

		.menu-title { font-size: 2rem; font-weight: 800; color: var(--primary-color); margin: 0 0 10px 0; }
		.menu-text { color: #7f8c8d; margin-bottom: 25px; line-height: 1.5; font-size: 0.95rem; }
		
		.mode-select {
			display: flex; flex-direction: column; gap: 12px;
		}
		.mode-btn {
			padding: 15px; border: 2px solid #ecf0f1; border-radius: 16px;
			background: white; text-align: left; cursor: pointer;
			display: flex; align-items: center; gap: 15px;
			transition: border-color 0.2s;
		}
		.mode-btn:hover { border-color: var(--accent-color); }
		.mode-icon { font-size: 1.5rem; background: #fff5e6; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 10px; }

		.shake { animation: shake 0.3s ease-in-out; }
		@keyframes shake {
			0% { transform: translateX(0); } 25% { transform: translateX(-5px); }
			50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); }
		}

		/* Mobil D√ºzenlemeler */
		@media (max-width: 480px) {
			.game-container { gap: 10px; }
			.board-wrapper { padding: 8px; }
			:root { --board-size: 42vw; } 
			.palette-grid { gap: 6px; }
		}
	</style>
</head>
<body>

	<div id="start-modal" class="modal-overlay active">
		<div class="menu-card">
			<div style="font-size:3rem; margin-bottom:10px;">üß©</div>
			<h1 class="menu-title">DESEN AVCISI</h1>
			<p class="menu-text">Verilen deseni incele ve par√ßalarƒ± kullanarak aynƒ±sƒ±nƒ± kendi alanƒ±nda olu≈ütur.</p>
			
			<div class="mode-select">
				<div class="mode-btn" onclick="startGame('solo')">
					<div class="mode-icon">üéì</div>
					<div>
						<div style="font-weight:700; color:var(--primary-color)">Alƒ±≈ütƒ±rma Modu</div>
						<div style="font-size:0.8rem; color:#95a5a6">S√ºre yok, 20 seviye. √ñƒüren ve geli≈ü.</div>
					</div>
				</div>
				<div class="mode-btn" onclick="startGame('vs')">
					<div class="mode-icon">‚ö°</div>
					<div>
						<div style="font-weight:700; color:var(--primary-color)">Meydan Okuma</div>
						<div style="font-size:0.8rem; color:#95a5a6">S√ºreye kar≈üƒ± yarƒ±≈ü. Hata kabul etmez.</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div id="end-modal" class="modal-overlay">
		<div class="menu-card">
			<div id="modal-icon" style="font-size: 4rem; margin-bottom: 10px;">üèÜ</div>
			<h2 id="modal-title" class="menu-title">Ba≈ülƒ±k</h2>
			<p id="modal-msg" class="menu-text">Mesaj</p>
			<button id="modal-btn" class="check-btn">Tamam</button>
		</div>
	</div>

	<header>
		<div class="brand"><span>DESEN</span> AVCISI</div>
		<div class="level-pill" id="level-txt">Seviye 1</div>
		<div class="header-actions">
			<button onclick="showHelp()">?</button>
			<button class="exit-btn" onclick="location.reload()">‚úï</button>
		</div>
	</header>

	<main>
		<div id="vs-status">
			<div class="vs-label"><span>‚è≥ Kalan S√ºre</span></div>
			<div class="bar-bg"><div id="timer-bar" class="bar-fill"></div></div>
		</div>

		<div class="game-container">
			<div class="board-wrapper">
				<div class="board-label">HEDEF</div>
				<canvas id="targetCanvas"></canvas>
			</div>

			<div class="board-wrapper" id="player-board">
				<div class="board-label">SENƒ∞N ALANIN</div>
				<div id="grid" class="grid"></div>
			</div>
		</div>
	</main>

	<div class="controls">
		<div class="palette-grid" id="palette">
			</div>
		<button class="check-btn" onclick="checkSolution()">KONTROL ET</button>
	</div>

	<script>
		const CONFIG = {
			totalLevels: 20,
			gridSize: 4,
			colors: { bg: '#ffffff', fill: '#2c3e50' }
		};

		const SHAPES = [
			{ id: 0, name: 'empty' }, { id: 1, name: 'full' },
			{ id: 2, name: 'tri-bl' }, { id: 3, name: 'tri-br' },
			{ id: 4, name: 'tri-tl' }, { id: 5, name: 'tri-tr' },
			{ id: 6, name: 'arc-bl' }, { id: 7, name: 'arc-br' },
			{ id: 8, name: 'arc-tl' }, { id: 9, name: 'arc-tr' },
			{ id: 10, name: 'dot' }, { id: 11, name: 'tri-inv' }
		];

		let state = {
			mode: 'solo',
			level: 1,
			targetGrid: [],
			playerGrid: new Array(16).fill(0),
			selectedShape: 1,
			timer: null
		};

		const canvas = document.getElementById('targetCanvas');
		const ctx = canvas.getContext('2d');
		const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

		function playTone(type) {
			if(audioCtx.state === 'suspended') audioCtx.resume();
			const osc = audioCtx.createOscillator();
			const gain = audioCtx.createGain();
			osc.connect(gain); gain.connect(audioCtx.destination);
			
			const now = audioCtx.currentTime;
			if (type === 'tap') {
				osc.frequency.setValueAtTime(600, now);
				osc.frequency.exponentialRampToValueAtTime(300, now + 0.1);
				gain.gain.setValueAtTime(0.05, now);
				gain.gain.linearRampToValueAtTime(0, now + 0.1);
				osc.start(); osc.stop(now + 0.1);
			} else if (type === 'win') {
				osc.type = 'triangle';
				osc.frequency.setValueAtTime(440, now);
				osc.frequency.setValueAtTime(554, now + 0.1);
				osc.frequency.setValueAtTime(659, now + 0.2);
				gain.gain.setValueAtTime(0.1, now);
				gain.gain.linearRampToValueAtTime(0, now + 0.4);
				osc.start(); osc.stop(now + 0.4);
			} else if (type === 'error') {
				osc.type = 'sawtooth';
				osc.frequency.setValueAtTime(150, now);
				osc.frequency.linearRampToValueAtTime(100, now + 0.2);
				gain.gain.setValueAtTime(0.1, now);
				gain.gain.linearRampToValueAtTime(0, now + 0.2);
				osc.start(); osc.stop(now + 0.2);
			}
		}

		function initPalette() {
			const palette = document.getElementById('palette');
			palette.innerHTML = '';
			SHAPES.forEach(shape => {
				const btn = document.createElement('div');
				btn.className = `p-btn ${shape.id === 1 ? 'active' : ''}`;
				btn.onclick = () => selectPalette(shape.id, btn);
				
				const iconCanvas = document.createElement('canvas');
				iconCanvas.width = 60; iconCanvas.height = 60;
				const iconCtx = iconCanvas.getContext('2d');
				drawShape(iconCtx, shape.id, 0, 0, 60);
				
				btn.style.backgroundImage = `url(${iconCanvas.toDataURL()})`;
				palette.appendChild(btn);
			});
		}

		function drawShape(c, type, x, y, size) {
			c.beginPath();
			c.fillStyle = CONFIG.colors.fill;
			const s = size;

			switch(type) {
				case 0: c.fillStyle = "#fff"; c.fillRect(x,y,s,s); break;
				case 1: c.fillRect(x,y,s,s); break;
				case 2: c.moveTo(x,y); c.lineTo(x, y+s); c.lineTo(x+s, y+s); c.fill(); break;
				case 3: c.moveTo(x+s,y); c.lineTo(x+s, y+s); c.lineTo(x, y+s); c.fill(); break;
				case 4: c.moveTo(x,y); c.lineTo(x+s, y); c.lineTo(x, y+s); c.fill(); break;
				case 5: c.moveTo(x,y); c.lineTo(x+s, y); c.lineTo(x+s, y+s); c.fill(); break;
				case 6: c.moveTo(x, y+s); c.arc(x, y+s, s, 0, -Math.PI/2, true); c.lineTo(x, y+s); c.fill(); break;
				case 7: c.moveTo(x+s, y+s); c.arc(x+s, y+s, s, Math.PI, Math.PI*1.5, false); c.lineTo(x+s, y+s); c.fill(); break;
				case 8: c.moveTo(x, y); c.arc(x, y, s, 0, Math.PI/2, false); c.lineTo(x, y); c.fill(); break;
				case 9: c.moveTo(x+s, y); c.arc(x+s, y, s, Math.PI, Math.PI/2, true); c.lineTo(x+s, y); c.fill(); break;
				case 10: c.arc(x+s/2, y+s/2, s/3, 0, Math.PI*2); c.fill(); break;
				case 11: c.fillStyle = "#fff"; c.fillRect(x,y,s,s); c.fillStyle = CONFIG.colors.fill;
					c.beginPath(); c.moveTo(x,y+s); c.lineTo(x+s/2, y+s); c.lineTo(x+s, y+s/2); c.lineTo(x+s, y); c.fill();
					c.beginPath(); c.moveTo(x, y); c.lineTo(x+s/2, y); c.lineTo(x, y+s/2); c.fill(); break;
			}
		}

		function generateLevel(lvl) {
			state.targetGrid = new Array(16).fill(0);
			
			// --- ZORLUK AYARI (D√úZELTƒ∞LDƒ∞) ---
			// ƒ∞lk seviyelerden itibaren √º√ßgenler de dahil (0-5 arasƒ±)
			// B√∂ylece sadece kare deƒüil, ≈üekil olu≈üturma ba≈ülƒ±yor.
			let allowedShapes = [0, 1, 2, 3, 4, 5]; 
			
			if (lvl > 7) allowedShapes.push(6, 7, 8, 9); // Yaylar
			if (lvl > 12) allowedShapes.push(10, 11); // Noktalar
			
			if (lvl <= 3) {
				// Giri≈ü: Basit desenler ama ≈üekilli
				for(let i=0; i<16; i++) state.targetGrid[i] = allowedShapes[Math.floor(Math.random()*allowedShapes.length)];
			} 
			else if (lvl <= 8) {
				// Simetri (Dikey)
				for(let r=0; r<4; r++) {
					for(let c=0; c<2; c++) {
						let val = allowedShapes[Math.floor(Math.random()*allowedShapes.length)];
						state.targetGrid[r*4 + c] = val;
						// Aynalama basit: Aynƒ± ≈üekli koyuyoruz ≈üimdilik simetri hissi i√ßin
						// ƒ∞stenirse getMirrorShape ile tam ayna yapƒ±labilir
						state.targetGrid[r*4 + (3-c)] = getMirrorShape(val, 'h');
					}
				}
			} 
			else if (lvl <= 14) {
				// √áeyrek Simetri (Radial)
				let q = [0,1,2,3].map(()=> allowedShapes[Math.floor(Math.random()*allowedShapes.length)]);
				state.targetGrid[0] = q[0]; state.targetGrid[1] = q[1];
				state.targetGrid[4] = q[2]; state.targetGrid[5] = q[3];
				for(let i=0; i<16; i++) if(i!==0 && i!==1 && i!==4 && i!==5) state.targetGrid[i] = allowedShapes[Math.floor(Math.random()*allowedShapes.length)];
			}
			else {
				// Kaos
				let base = allowedShapes[Math.floor(Math.random()*allowedShapes.length)];
				let alt = allowedShapes[Math.floor(Math.random()*allowedShapes.length)];
				for(let i=0; i<16; i++) state.targetGrid[i] = (i%2===0) ? base : alt;
				// √úzerine biraz noise
				for(let k=0; k<5; k++) state.targetGrid[Math.floor(Math.random()*16)] = allowedShapes[Math.floor(Math.random()*allowedShapes.length)];
			}
			renderTarget();
		}

		function getMirrorShape(id, axis) {
			if(axis === 'h') {
				if(id===2) return 3; if(id===3) return 2;
				if(id===4) return 5; if(id===5) return 4;
				if(id===6) return 7; if(id===7) return 6;
				if(id===8) return 9; if(id===9) return 8;
			}
			return id;
		}

		function renderTarget() {
			const size = canvas.clientWidth;
			const dpr = window.devicePixelRatio || 1;
			canvas.width = size * dpr;
			canvas.height = size * dpr;
			ctx.scale(dpr, dpr);
			
			const cellSize = size / 4;
			ctx.clearRect(0,0,size,size);
			
			for(let i=0; i<16; i++) {
				const x = (i % 4) * cellSize;
				const y = Math.floor(i / 4) * cellSize;
				drawShape(ctx, state.targetGrid[i], x, y, cellSize);
			}
		}

		function startGame(mode) {
			state.mode = mode;
			state.level = 1;
			document.getElementById('start-modal').classList.remove('active');
			document.getElementById('vs-status').style.display = (mode === 'vs') ? 'flex' : 'none';
			initPalette();
			createGrid();
			loadLevel();
		}

		function createGrid() {
			const grid = document.getElementById('grid');
			grid.innerHTML = '';
			for(let i=0; i<16; i++) {
				const cell = document.createElement('div');
				cell.className = 'cell';
				updateCellVisual(cell, 0);
				cell.onclick = () => {
					playTone('tap');
					state.playerGrid[i] = state.selectedShape;
					updateCellVisual(cell, state.selectedShape);
				};
				grid.appendChild(cell);
			}
		}
		
		function updateCellVisual(element, typeId) {
			const c = document.createElement('canvas');
			c.width = 64; c.height = 64;
			const cx = c.getContext('2d');
			drawShape(cx, typeId, 0, 0, 64);
			element.style.backgroundImage = `url(${c.toDataURL()})`;
		}

		function selectPalette(id, btn) {
			playTone('tap');
			state.selectedShape = id;
			document.querySelectorAll('.p-btn').forEach(b => b.classList.remove('active'));
			btn.classList.add('active');
		}

		function loadLevel() {
			document.getElementById('level-txt').innerText = `Seviye ${state.level} / ${CONFIG.totalLevels}`;
			state.playerGrid.fill(0);
			document.querySelectorAll('.cell').forEach(c => updateCellVisual(c, 0));
			generateLevel(state.level);
			if(state.mode === 'vs') startTimer();
		}

		function startTimer() {
			if(state.timer) clearInterval(state.timer);
			const bar = document.getElementById('timer-bar');
			bar.style.width = '100%';
			let duration = Math.max(20, 90 - (state.level * 3));
			let left = duration;
			
			state.timer = setInterval(() => {
				left -= 0.1;
				let pct = (left / duration) * 100;
				bar.style.width = pct + '%';
				if(left <= 0) {
					clearInterval(state.timer);
					playTone('error');
					showInfoModal("S√ºre Doldu", "Ba≈ütan ba≈ülaman gerekiyor.", "‚è∞", "Tekrar Dene", () => location.reload());
				}
			}, 100);
		}

		function checkSolution() {
			let correct = true;
			for(let i=0; i<16; i++) if(state.playerGrid[i] !== state.targetGrid[i]) correct = false;

			if(correct) {
				if(state.timer) clearInterval(state.timer);
				playTone('win');
				if(state.level === CONFIG.totalLevels) {
					showInfoModal("TEBRƒ∞KLER!", "T√ºm desenleri tamamladƒ±n. Harika i≈ü!", "üèÜ", "Ba≈üa D√∂n", () => location.reload());
				} else {
					showInfoModal("Harika!", "Doƒüru desen.", "‚≠ê", "Devam Et", () => {
						document.getElementById('end-modal').classList.remove('active');
						state.level++;
						loadLevel();
					});
				}
			} else {
				playTone('error');
				const board = document.getElementById('player-board');
				board.classList.add('shake');
				setTimeout(() => board.classList.remove('shake'), 400);
			}
		}

		// Genel Modal Fonksiyonu (Yardƒ±m ve Biti≈ü i√ßin)
		function showInfoModal(title, msg, icon, btnText, action) {
			document.getElementById('modal-title').innerText = title;
			document.getElementById('modal-msg').innerText = msg;
			document.getElementById('modal-icon').innerText = icon;
			const btn = document.getElementById('modal-btn');
			btn.innerText = btnText;
			btn.onclick = action;
			document.getElementById('end-modal').classList.add('active');
		}

		function showHelp() {
			showInfoModal(
				"Nasƒ±l Oynanƒ±r?", 
				"Ama√ß: Hedef tahtasƒ±ndaki desenin aynƒ±sƒ±nƒ± kendi alanƒ±nda olu≈üturmaktƒ±r.\n\n1. A≈üaƒüƒ±daki panelden bir ≈üekil se√ß.\n2. Kendi alanƒ±ndaki karelere dokunarak ≈üekli yerle≈ütir.\n3. Deseni tamamlayƒ±nca 'KONTROL ET' butonuna bas.", 
				"üí°", 
				"Anladƒ±m", 
				() => document.getElementById('end-modal').classList.remove('active')
			);
		}

		window.addEventListener('resize', () => { renderTarget(); });
		window.onload = () => {};
	</script>
</body>
</html>