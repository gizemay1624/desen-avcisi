<!DOCTYPE html>
<html lang="tr">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>Desen AvcÄ±sÄ±</title>
	<style>
		:root {
			--bg: #f8fafc;
			--surface: #ffffff;
			--primary: #334155;
			--accent: #4f46e5;
			--success: #10b981;
			--danger: #ef4444;
			--border: #cbd5e1;
			--shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
			--modal-overlay: rgba(15, 23, 42, 0.9);
		}

		* { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
		
		body {
			margin: 0; padding: 0;
			font-family: 'Segoe UI', system-ui, sans-serif;
			background-color: var(--bg);
			color: var(--primary);
			height: 100vh; /* Mobil tarayÄ±cÄ± bar sorununu Ã§Ã¶zer */
			height: 100dvh; 
			display: flex;
			flex-direction: column;
			overflow: hidden; /* Asla scroll Ã§Ä±kmasÄ±n */
		}

		/* --- HEADER --- */
		header {
			background: var(--surface);
			padding: 0 15px;
			display: flex;
			justify-content: space-between;
			align-items: center;
			height: 50px; /* Daha kompakt */
			flex-shrink: 0;
			border-bottom: 1px solid var(--border);
		}

		.level-badge {
			background: var(--accent); color: white;
			padding: 4px 10px; border-radius: 15px;
			font-weight: 700; font-size: 0.85rem;
		}

		.header-right { display: flex; gap: 10px; }
		
		.icon-btn {
			background: #f1f5f9; border: none;
			width: 32px; height: 32px; border-radius: 50%;
			font-weight: bold; cursor: pointer; color: var(--primary);
			display: flex; align-items: center; justify-content: center;
		}
		.exit-btn { color: var(--danger); background: #fee2e2; }

		/* --- OYUN ALANI (MAIN) --- */
		main {
			flex: 1; /* Kalan tÃ¼m alanÄ± kapla */
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: space-evenly; /* Dikeyde eÅŸit daÄŸÄ±t */
			padding: 10px;
			width: 100%;
			position: relative;
		}

		/* VS Modu BarÄ± */
		#rival-wrapper {
			width: 90%; max-width: 400px;
			display: none; flex-direction: column; gap: 3px;
			margin-bottom: 5px;
		}
		.progress-bg { height: 6px; background: #e2e8f0; border-radius: 3px; overflow: hidden; }
		.progress-fill { height: 100%; background: var(--danger); width: 0%; transition: width 0.2s linear; }

		.boards-container {
			display: flex;
			gap: 15px; /* Mobilde daha sÄ±kÄ±ÅŸÄ±k */
			align-items: center;
			justify-content: center;
			width: 100%;
		}

		.game-card {
			background: var(--surface);
			padding: 8px;
			border-radius: 12px;
			box-shadow: var(--shadow);
			display: flex;
			flex-direction: column;
			align-items: center;
		}
		
		.card-title {
			font-size: 0.7rem; font-weight: 700; color: #94a3b8;
			margin-bottom: 5px; letter-spacing: 0.5px;
		}

		/* Canvas ve Grid AyarlarÄ± - EN Ã–NEMLÄ° KISIM */
		/* EkranÄ±n en kÄ±sa kenarÄ±na gÃ¶re boyut al (vmin). BÃ¶ylece asla taÅŸmaz. */
		canvas, .player-grid {
			width: 38vmin; height: 38vmin; /* Mobilde yan yana sÄ±ÄŸmasÄ± iÃ§in */
			max-width: 250px; max-height: 250px; /* PC de devasa olmasÄ±n */
			min-width: 140px; min-height: 140px;
			border-radius: 4px;
		}

		canvas { background: #fff; box-shadow: inset 0 0 0 1px #cbd5e1; }

		.player-grid {
			display: grid;
			grid-template-columns: repeat(4, 1fr);
			gap: 1px;
			background: #cbd5e1;
			border: 3px solid #fff;
		}

		.cell {
			background-color: #fff; cursor: pointer; position: relative;
			touch-action: manipulation;
		}
		.cell:active { transform: scale(0.9); z-index: 2; }

		/* --- KONTROLLER (ALT PANEL) --- */
		.controls {
			background: var(--surface);
			width: 100%;
			padding: 10px 10px calc(15px + env(safe-area-inset-bottom)) 10px;
			box-shadow: 0 -4px 20px rgba(0,0,0,0.05);
			display: flex;
			flex-direction: column;
			align-items: center;
			border-top-left-radius: 20px; border-top-right-radius: 20px;
			z-index: 20;
			flex-shrink: 0; /* KÃ¼Ã§Ã¼lmesine izin verme */
		}

		.palette {
			display: flex; gap: 8px;
			justify-content: center; flex-wrap: wrap;
			margin-bottom: 10px;
			max-width: 600px;
		}

		.p-btn {
			width: 11vmin; height: 11vmin; /* Ekran boyutuna gÃ¶re buton */
			max-width: 50px; max-height: 50px;
			border-radius: 8px;
			border: 2px solid #e2e8f0;
			cursor: pointer;
			position: relative;
		}

		.p-btn.active { border-color: var(--accent); transform: translateY(-3px); }
		.p-btn.active::after {
			content: ''; position: absolute; bottom: -6px; left: 50%;
			transform: translateX(-50%); width: 4px; height: 4px;
			background: var(--accent); border-radius: 50%;
		}

		.check-btn {
			background: var(--primary); color: white; border: none;
			padding: 12px 40px; border-radius: 10px;
			font-size: 0.95rem; font-weight: 600; cursor: pointer;
			width: 90%; max-width: 300px;
		}

		/* --- DESEN CSS SINIFLARI --- */
		/* Temel */
		.pat-0 { background: #fff; } 
		.pat-1 { background: #1e293b; } 
		/* Noktalar */
		.pat-4 { background: radial-gradient(circle, #1e293b 35%, #fff 36%); }
		.pat-5 { background: radial-gradient(circle, #fff 35%, #1e293b 36%); }
		/* ÃœÃ§genler (TÃ¼m YÃ¶nler - Diamond yapÄ±mÄ± iÃ§in gerekli) */
		.pat-2 { background: linear-gradient(45deg, #1e293b 50%, #fff 50%); } /* Sol Alt */
		.pat-3 { background: linear-gradient(135deg, #fff 50%, #1e293b 50%); } /* SaÄŸ Alt */
		.pat-6 { background: linear-gradient(135deg, #1e293b 50%, #fff 50%); } /* Sol Ãœst (Yeni) */
		.pat-7 { background: linear-gradient(45deg, #fff 50%, #1e293b 50%); } /* SaÄŸ Ãœst (Yeni) */

		/* --- FULL SCREEN MODALS --- */
		.overlay, .modal-backdrop {
			position: fixed; top:0; left:0; right:0; bottom:0;
			display: flex; flex-direction: column;
			align-items: center; justify-content: center;
			z-index: 100;
		}
		
		.overlay { background: var(--bg); overflow-y: auto; padding: 20px; }
		.modal-backdrop { 
			background: var(--modal-overlay); 
			backdrop-filter: blur(4px);
			opacity: 0; pointer-events: none; transition: opacity 0.3s;
			z-index: 200;
		}
		.modal-backdrop.show { opacity: 1; pointer-events: all; }

		.modal-card {
			background: white; padding: 25px; border-radius: 16px;
			width: 85%; max-width: 320px; text-align: center;
			transform: scale(0.9); transition: transform 0.3s;
		}
		.modal-backdrop.show .modal-card { transform: scale(1); }

		.instruction-box {
			background: white; padding: 15px; border-radius: 12px;
			border: 1px solid var(--border); color: #64748b; font-size: 0.9rem;
			max-width: 400px; margin-bottom: 20px; line-height: 1.5;
		}
		
		.hero-title { font-size: 2rem; color: var(--primary); font-weight: 800; margin:0;}
		
		.mode-card {
			background: white; padding: 12px 15px; margin-bottom: 10px;
			border-radius: 12px; border: 2px solid transparent;
			box-shadow: var(--shadow); cursor: pointer;
			display: flex; align-items: center; gap: 10px; width: 100%; max-width: 340px;
		}
		.mode-card:hover { border-color: var(--accent); }

		.hidden { display: none !important; }

		/* Responsive DÃ¼zeltmeler */
		@media (min-width: 600px) {
			/* PC EkranÄ± */
			.boards-container { gap: 40px; }
			canvas, .player-grid { width: 220px; height: 220px; }
			.p-btn { width: 50px; height: 50px; }
			.controls { padding-bottom: 20px; border-radius: 0; box-shadow: none; border-top: 1px solid var(--border); }
		}
	</style>
</head>
<body>

	<div id="start-screen" class="overlay">
		<div class="hero-title">DESEN AVCISI</div>
		<p style="color:var(--accent); font-weight:600; margin-bottom: 20px;">GÃ¶rsel Zeka Oyunu</p>
		
		<div class="instruction-box">
			<b>AmaÃ§:</b> Hedef tahtasÄ±ndaki desenin aynÄ±sÄ±nÄ± kendi alanÄ±nda oluÅŸtur.<br>
			Toplam <b>20 Seviye</b> seni bekliyor. Desenler giderek karmaÅŸÄ±klaÅŸacak!
		</div>

		<div class="mode-card" onclick="initGame('solo')">
			<span style="font-size: 1.5rem;">ğŸ§ </span>
			<div style="text-align:left;">
				<div style="font-weight:700;">AlÄ±ÅŸtÄ±rma Modu</div>
				<div style="font-size:0.8rem; color:#94a3b8;">SÃ¼re yok, 20 seviyeyi tamamla.</div>
			</div>
		</div>

		<div class="mode-card" onclick="initGame('vs')">
			<span style="font-size: 1.5rem;">âš¡</span>
			<div style="text-align:left;">
				<div style="font-weight:700;">DÃ¼ello Modu</div>
				<div style="font-size:0.8rem; color:#94a3b8;">Yapay Zeka her seviyede hÄ±zlanÄ±r.</div>
			</div>
		</div>
	</div>

	<div id="game-modal" class="modal-backdrop">
		<div class="modal-card">
			<div id="modal-icon" style="font-size: 3rem; margin-bottom: 10px;">ğŸ†</div>
			<h2 id="modal-title" style="margin: 0 0 10px 0; color:var(--primary);">Tebrikler!</h2>
			<p id="modal-msg" style="color:#64748b; margin-bottom: 20px;">Seviye tamamlandÄ±.</p>
			<button id="modal-action-btn" class="check-btn" onclick="closeGameModal()">Devam Et</button>
		</div>
	</div>

	<header>
		<div style="display:flex; align-items:center; gap:8px;">
			<div class="level-badge" id="level-display">Seviye 1/20</div>
		</div>
		<div class="header-right">
			<button class="icon-btn" onclick="showHelp()">?</button>
			<button class="icon-btn exit-btn" onclick="location.reload()">âœ•</button>
		</div>
	</header>

	<main>
		<div id="rival-wrapper">
			<div style="display:flex; justify-content:space-between; font-size:0.75rem; color:#64748b;">
				<span>ğŸ¤– Rakip</span>
				<span>HÄ±zlanÄ±yor...</span>
			</div>
			<div class="progress-bg"><div id="rival-bar" class="progress-fill"></div></div>
		</div>

		<div class="boards-container">
			<div class="game-card">
				<div class="card-title">HEDEF</div>
				<canvas id="targetCanvas" width="200" height="200"></canvas>
			</div>

			<div class="game-card">
				<div class="card-title">SENÄ°N ALANIN</div>
				<div id="grid" class="player-grid"></div>
			</div>
		</div>
	</main>

	<div class="controls">
		<div class="palette" id="palette">
			<div class="p-btn pat-0 active" onclick="selectPattern(0, this)"></div>
			<div class="p-btn pat-1" onclick="selectPattern(1, this)"></div>
			<div class="p-btn pat-2" onclick="selectPattern(2, this)"></div> <div class="p-btn pat-3" onclick="selectPattern(3, this)"></div> <div class="p-btn pat-6" onclick="selectPattern(6, this)"></div> <div class="p-btn pat-7" onclick="selectPattern(7, this)"></div> <div class="p-btn pat-4" onclick="selectPattern(4, this)"></div>
			<div class="p-btn pat-5" onclick="selectPattern(5, this)"></div>
		</div>
		<button class="check-btn" onclick="checkSolution()">KONTROL ET</button>
	</div>

	<script>
		// --- AYARLAR ---
		const MAX_LEVEL = 20;
		const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
		
		let currentMode = 'solo';
		let currentLevel = 1;
		let activePatternId = 0;
		let targetData = [];
		let playerData = Array(16).fill(0);
		let isGameRunning = false;
		let rivalInterval;
		let modalCallback = null;

		const canvas = document.getElementById('targetCanvas');
		const ctx = canvas.getContext('2d');
		const dpr = window.devicePixelRatio || 1;

		function playSound(type) {
			if(audioCtx.state === 'suspended') audioCtx.resume();
			const osc = audioCtx.createOscillator();
			const gain = audioCtx.createGain();
			osc.connect(gain); gain.connect(audioCtx.destination);

			const now = audioCtx.currentTime;
			if(type === 'win') {
				osc.frequency.setValueAtTime(523.25, now);
				osc.frequency.exponentialRampToValueAtTime(1046.5, now + 0.1);
				gain.gain.setValueAtTime(0.1, now);
				gain.gain.linearRampToValueAtTime(0, now + 0.3);
				osc.start(); osc.stop(now + 0.3);
			} else if(type === 'pop') {
				osc.frequency.setValueAtTime(400, now);
				gain.gain.setValueAtTime(0.05, now);
				gain.gain.linearRampToValueAtTime(0, now + 0.05);
				osc.start(); osc.stop(now + 0.05);
			} else {
				osc.type = 'sawtooth';
				osc.frequency.setValueAtTime(150, now);
				osc.frequency.linearRampToValueAtTime(100, now + 0.2);
				gain.gain.setValueAtTime(0.1, now);
				gain.gain.linearRampToValueAtTime(0, now + 0.2);
				osc.start(); osc.stop(now + 0.2);
			}
		}

		function resizeCanvas() {
			const rect = canvas.getBoundingClientRect();
			canvas.width = rect.width * dpr;
			canvas.height = rect.height * dpr;
			ctx.scale(dpr, dpr);
			if(targetData.length > 0) drawCanvas();
		}
		window.addEventListener('resize', resizeCanvas);

		function initGame(mode) {
			if(audioCtx.state === 'suspended') audioCtx.resume();
			playSound('pop');
			currentMode = mode;
			currentLevel = 1;
			
			document.getElementById('start-screen').classList.add('hidden');
			document.getElementById('rival-wrapper').style.display = (mode === 'vs') ? 'flex' : 'none';

			createGrid();
			resizeCanvas();
			startLevel();
		}

		function createGrid() {
			const grid = document.getElementById('grid');
			grid.innerHTML = '';
			for(let i=0; i<16; i++) {
				let cell = document.createElement('div');
				cell.className = 'cell pat-0';
				cell.onclick = function() {
					if(!isGameRunning) return;
					playSound('pop');
					playerData[i] = activePatternId;
					this.className = `cell pat-${activePatternId}`;
				}
				grid.appendChild(cell);
			}
		}

		function startLevel() {
			if(currentLevel > MAX_LEVEL) {
				gameFinished();
				return;
			}
			isGameRunning = true;
			document.getElementById('level-display').innerText = `Seviye ${currentLevel}/${MAX_LEVEL}`;
			
			playerData.fill(0);
			document.querySelectorAll('.cell').forEach(c => c.className = 'cell pat-0');

			generateTarget();

			if(currentMode === 'vs') startRivalAI();
		}

		// --- ZORLUK VE DESEN ALGORÄ°TMASI ---
		function generateTarget() {
			targetData = Array(16).fill(0);
			
			// Blok Havuzu (Seviyeye gÃ¶re aÃ§Ä±lÄ±r)
			let pool = [0, 1]; // Sadece siyah beyaz
			if(currentLevel > 4) pool.push(2, 3, 6, 7); // TÃ¼m Ã¼Ã§genler
			if(currentLevel > 10) pool.push(4, 5); // Noktalar

			// Doldurma MantÄ±ÄŸÄ± (Seviyeye gÃ¶re)
			if(currentLevel <= 5) {
				// Tamamen rastgele basit
				for(let i=0; i<16; i++) targetData[i] = pool[Math.floor(Math.random()*pool.length)];
			} 
			else if (currentLevel <= 10) {
				// Simetri Yok ama ÃœÃ§genler var (Orta)
				for(let i=0; i<16; i++) targetData[i] = pool[Math.floor(Math.random()*pool.length)];
			}
			else {
				// SÄ°METRÄ°K MOD (ZOR - AttÄ±ÄŸÄ±n gÃ¶rsel tarzÄ±)
				// Sol yarÄ±yÄ± oluÅŸtur
				for(let r=0; r<4; r++) {
					for(let c=0; c<2; c++) {
						let val = pool[Math.floor(Math.random()*pool.length)];
						let idx = r*4 + c;
						targetData[idx] = val;
						
						// SaÄŸ tarafÄ± simetrik yap (Ayna efekti)
						// 2,3,6,7 Ã¼Ã§genlerini aynalamak iÃ§in mantÄ±k gerekir
						let mirrorIdx = r*4 + (3-c);
						let mirrorVal = val;
						
						// ÃœÃ§genleri aynala: Sol Alt(2) <-> SaÄŸ Alt(3), Sol Ãœst(6) <-> SaÄŸ Ãœst(7)
						if(val === 2) mirrorVal = 3;
						else if(val === 3) mirrorVal = 2;
						else if(val === 6) mirrorVal = 7;
						else if(val === 7) mirrorVal = 6;
						
						targetData[mirrorIdx] = mirrorVal;
					}
				}
			}
			drawCanvas();
		}

		function drawCanvas() {
			const w = canvas.width / dpr;
			const cellSize = w / 4;
			ctx.clearRect(0,0, w, w);

			for(let i=0; i<16; i++) {
				const type = targetData[i];
				const x = (i % 4) * cellSize;
				const y = Math.floor(i / 4) * cellSize;
				
				ctx.beginPath();
				// Zemin
				if([0, 2, 3, 4, 6, 7].includes(type)) { ctx.fillStyle="#fff"; ctx.fillRect(x,y,cellSize,cellSize); }
				if([1, 5].includes(type)) { ctx.fillStyle="#1e293b"; ctx.fillRect(x,y,cellSize,cellSize); }
				
				ctx.fillStyle = "#1e293b";
				if(type === 2) { // Sol Alt
					ctx.moveTo(x,y); ctx.lineTo(x+cellSize, y+cellSize); ctx.lineTo(x, y+cellSize); ctx.fill();
				} else if (type === 3) { // SaÄŸ Alt
					ctx.moveTo(x+cellSize,y); ctx.lineTo(x+cellSize, y+cellSize); ctx.lineTo(x, y+cellSize); ctx.fill();
				} else if (type === 6) { // Sol Ãœst (Yeni)
					ctx.moveTo(x,y); ctx.lineTo(x+cellSize, y); ctx.lineTo(x, y+cellSize); ctx.fill();
				} else if (type === 7) { // SaÄŸ Ãœst (Yeni)
					ctx.moveTo(x,y); ctx.lineTo(x+cellSize, y); ctx.lineTo(x+cellSize, y+cellSize); ctx.fill();
				} else if (type === 4) { // Nokta Beyaz
					ctx.beginPath(); ctx.arc(x+cellSize/2, y+cellSize/2, cellSize/3.5, 0, Math.PI*2); ctx.fill();
				} else if (type === 5) { // Nokta Siyah (Ä°Ã§i beyaz)
					ctx.fillStyle = "#fff";
					ctx.beginPath(); ctx.arc(x+cellSize/2, y+cellSize/2, cellSize/3.5, 0, Math.PI*2); ctx.fill();
				}
			}
		}

		function selectPattern(id, btn) {
			playSound('pop');
			activePatternId = id;
			document.querySelectorAll('.p-btn').forEach(b => b.classList.remove('active'));
			btn.classList.add('active');
		}

		function checkSolution() {
			if(!isGameRunning) return;
			let correct = true;
			for(let i=0; i<16; i++) if(playerData[i] !== targetData[i]) correct = false;

			if(correct) {
				clearInterval(rivalInterval);
				playSound('win');
				currentLevel++;
				showModal("Harika!", "DoÄŸru desen.", "â­", "SÄ±radaki", startLevel);
			} else {
				playSound('error');
				const grid = document.getElementById('grid');
				grid.style.transform = "translateX(5px)";
				setTimeout(()=>grid.style.transform="none", 100);
			}
		}

		function startRivalAI() {
			let bar = document.getElementById('rival-bar');
			bar.style.width = '0%';
			let progress = 0;
			// Seviye arttÄ±kÃ§a sÃ¼re kÄ±salÄ±r (60sn -> 15sn)
			let duration = Math.max(15, 60 - (currentLevel * 2.5)); 
			let tick = (duration * 1000) / 100;

			clearInterval(rivalInterval);
			rivalInterval = setInterval(() => {
				progress++;
				bar.style.width = progress + '%';
				if(progress >= 100) {
					clearInterval(rivalInterval);
					isGameRunning = false;
					playSound('error');
					showModal("SÃ¼re Doldu", "Rakip kazandÄ±.", "ğŸ¤–", "Tekrar Dene", () => {
						currentLevel = 1; startLevel();
					});
				}
			}, tick);
		}

		function gameFinished() {
			isGameRunning = false;
			playSound('win');
			showModal("ÅAMPÄ°YON!", "TÃ¼m seviyeleri tamamladÄ±n!", "ğŸ†", "BaÅŸa DÃ¶n", () => location.reload());
		}

		function showModal(title, msg, icon, btn, cb) {
			document.getElementById('modal-title').innerText = title;
			document.getElementById('modal-msg').innerText = msg;
			document.getElementById('modal-icon').innerText = icon;
			document.getElementById('modal-action-btn').innerText = btn;
			document.getElementById('game-modal').classList.add('show');
			modalCallback = cb;
		}
		function closeGameModal() {
			document.getElementById('game-modal').classList.remove('show');
			if(modalCallback) modalCallback();
		}
		function showHelp() {
			showModal("NasÄ±l OynanÄ±r?", "AÅŸaÄŸÄ±dan deseni seÃ§, karelere dokun, ÅŸekli oluÅŸtur.", "ğŸ’¡", "Tamam", null);
		}
	</script>
</body>
</html>